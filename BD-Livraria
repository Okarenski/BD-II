CREATE OR REPLACE FUNCTION cliente_verificar_delete()
RETURNS TRIGGER AS $$
BEGIN
	IF EXISTS (SELECT 1 FROM pedidos WHERE id_cliente = id_pedido) THEN
	RAISE EXCEPTION 'Cliente n√£o pode ser deletado pois efetuou pedido';
	END IF;

	RETURN OLD;
END
$$ LANGUAGE plpgsql;

CREATE OR REPLACE TRIGGER cliente_delete_pedido
BEFORE DELETE
ON clientes
EXECUTE FUNCTION cliente_verificar_delete();

DELETE FROM clientes WHERE id_cliente = 1;

-- ex 4 tudo ok!

CREATE OR REPLACE FUNCTION att_status_enviado()
RETURNS TRIGGER AS $$
BEGIN
	IF NEW.status_item = 'Enviado' THEN
		UPDATE pedidos SET status = 'Concluido' WHERE id_pedido = NEW.id_pedido;
	END IF;

	RETURN NEW;
END;
$$ LANGUAGE plpgsql;	

CREATE OR REPLACE TRIGGER att_status_pedido
AFTER UPDATE OF status_item ON itens_pedido
FOR EACH ROW
EXECUTE FUNCTION att_status_enviado();

SELECT * FROM itens_pedido;
SELECT * FROM clientes;

UPDATE itens_pedido SET status_item = 'Enviado' WHERE id_item = 4;

-- ex 5 funcionando ok
